<div fxLayoutAlign="center" class="registration-container">
  <mat-card class="registration-form">
    <mat-card-header>
      <img [hidden]="newMode" mat-card-avatar src="{{ avatarUrl }}" />
      <h3>
        <mat-icon mat-card-avatar [hidden]="!newMode || avatarUrl">person</mat-icon> Your Profile
      </h3>
    </mat-card-header>
    <mat-horizontal-stepper [linear]="true" #stepper>
      <mat-step [stepControl]="basicInfoGroup">
        <form [formGroup]="basicInfoGroup">
          <ng-template matStepLabel>Basic Info</ng-template>
          <mat-form-field class="field-full-width">
            <input
              matInput
              placeholder="First Name"
              formControlName="fname"
              #fnameControl
              required
            />
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <input
              matInput
              placeholder="Last Name"
              formControlName="lname"
              #lnameControl
              required
            />
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field floatLabel="always" class="mat-form-field--no-underline">
            <mat-radio-group
              required
              name="genderControl"
              formControlName="gender"
              [(ngModel)]="genderSelected"
            >
              <mat-radio-button value="M" [checked]="gender === 'M'"
                >Male&nbsp;&nbsp;</mat-radio-button
              >
              <mat-radio-button value="F" [checked]="gender === 'F'">Female</mat-radio-button>
              <input matInput placeholder="Input" style="display: none" />
            </mat-radio-group>
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <input matInput placeholder="Email" required formControlName="email" #emailControl />
            <mat-error>{{ getErrorMessage() }}</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <input
              #birthyearControl
              matInput
              [matDatepicker]="picker"
              formControlName="birthyear"
              [min]="minDate"
              [max]="maxDate"
              placeholder="When were you born?"
            />
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker
              startView="multi-year"
              required
              [startAt]="yearStart"
              #picker
              (yearSelected)="birthYearSelected($event, picker)"
            ></mat-datepicker>
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <input
              type="text"
              matInput
              placeholder="Where are you from?"
              [formControl]="originCtrl"
              [matAutocomplete]="auto"
              #originControl
              required
            />
            <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn">
              <mat-option
                (onSelectionChange)="setOrigin(option)"
                *ngFor="let option of filteredCountries | async"
                [value]="option"
              >
                {{ option.name }}
              </mat-option>
            </mat-autocomplete>
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <input
              matInput
              type="text"
              placeholder="Postcode"
              formControlName="postcode"
              #postcodeControl
              required
            />
            <mat-error>Required</mat-error>
          </mat-form-field>
          <div [hidden]="!postcodeControl.value">
            <app-map
              [postcode]="postcodeControl.value"
              [countryCode]="originCtrl.value"
              (latLng)="setLatLng($event)"
            ></app-map>
          </div>
          <button style="float:right;" (click)="findInvalidControls()" mat-button matStepperNext>Next</button>
        </form>
      </mat-step>
      <mat-step [stepControl]="detailGroup">
        <form [formGroup]="detailGroup">
          <ng-template matStepLabel>About You</ng-template>
          <mat-form-field class="field-full-width">
            <mat-select
              placeholder="What's your favorite music genre?"
              formControlName="musictype"
              #musictypeControl
              required
            >
              <mat-option value="dnb">Drum & Bass</mat-option>
              <mat-option value="house">House</mat-option>
              <mat-option value="techno">Techno</mat-option>
              <mat-option value="psytrance">Psytrance</mat-option>
              <mat-option value="other">Other</mat-option>
            </mat-select>
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <mat-select
              placeholder="What's your involvement in the scene?"
              formControlName="membertype"
              #membertypeControl
              required
            >
              <mat-option value="punter">I'm a party goer</mat-option>
              <mat-option value="dj">I'm a DJ</mat-option>
              <mat-option value="producer">I'm a producer</mat-option>
              <mat-option value="promoter">I'm a promoter</mat-option>
            </mat-select>
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <input
              #startyearControl
              matInput
              [matDatepicker]="picker2"
              formControlName="startyear"
              [min]="minDate"
              [max]="maxDate"
              placeholder="When did you start partying?"
            />
            <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
            <mat-datepicker
              startView="multi-year"
              required
              [startAt]="yearStart"
              #picker2
              (yearSelected)="partyStartYearSelected($event, picker2)"
            ></mat-datepicker>
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <mat-select
              placeholder="How often do you attend parties?"
              formControlName="partyfrequency"
              required
              #partyfrequencyControl
            >
              <mat-option value="one">Every week</mat-option>
              <mat-option value="two">Twice a month</mat-option>
              <mat-option value="three">Once a month</mat-option>
              <mat-option value="four">Regularly</mat-option>
              <mat-option value="five">Occassionally</mat-option>
              <mat-option value="six">Rarely</mat-option>
              <mat-option value="seven">Never</mat-option>
            </mat-select>
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <input
              matInput
              placeholder="What's your favourite party?"
              formControlName="favouriteparty"
              #favouritepartyControl
            />
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <mat-select
              placeholder="How often do you attend festivals?"
              formControlName="festivalfrequency"
              #festivalfrequencyControl
              required
            >
              <mat-option value="1">Once a year</mat-option>
              <mat-option value="2">Several times a year</mat-option>
              <mat-option value="3">Frequently</mat-option>
              <mat-option value="4">Never</mat-option>
            </mat-select>
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <input
              matInput
              placeholder="What's your favourite festival?"
              formControlName="favouritefestival"
              #favouritefestivalControl
            />
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <textarea
              class="reasonField"
              matInput
              placeholder="Tell us about yourself"
              formControlName="bio"
              #bioControl
            ></textarea>
          </mat-form-field>
          <button style="float:right;" mat-button matStepperNext>Next</button>
          <button style="float:right;" mat-button matStepperPrevious>Back</button>
        </form>
      </mat-step>
      <mat-step [stepControl]="opinionGroup">
        <form [formGroup]="opinionGroup">
          <ng-template matStepLabel>Your opinions</ng-template>
          <mat-form-field class="field-full-width" required>
            <mat-select placeholder="Status" formControlName="psystatus" #psystatusControl>
              <mat-option value="lifestyle">Is My Lifestyle</mat-option>
              <mat-option value="religion">Is My Religion</mat-option>
              <mat-option value="music">Is Just Music</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field class="field-full-width" required>
            <textarea
              class="reasonField"
              matInput
              placeholder="Reason"
              formControlName="reason"
              #reasonControl
            ></textarea>
          </mat-form-field>
          <div>
            <button mat-button matStepperPrevious>Back</button>
            <button
              type="submit"
              mat-raised-button
              color="primary"
              (click)="
                registerMember(
                  fnameControl.value,
                  lnameControl.value,
                  emailControl.value,
                  birthyearControl.value,
                  originControl.value,
                  postcodeControl.value,
                  psystatusControl.value,
                  reasonControl.value,
                  musictypeControl.value,
                  membertypeControl.value,
                  startyearControl.value,
                  bioControl.value,
                  partyfrequencyControl.value,
                  favouritepartyControl.value,
                  festivalfrequencyControl.value,
                  favouritefestivalControl.value
                )
              "
              [disabled]="
                (basicInfoGroup.pristine && opinionGroup.pristine && detailGroup.pristine) ||
                (basicInfoGroup.invalid || opinionGroup.invalid || detailGroup.invalid)
              "
            >
              Update
            </button>
          </div>
        </form>
      </mat-step>
    </mat-horizontal-stepper>
  </mat-card>
</div>

<!-- 

 -->
