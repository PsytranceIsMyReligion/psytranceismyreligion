<div fxLayoutAlign="center" class="registration-container">
  <mat-card class="registration-form">
    <mat-card-header>
      <img [hidden]="newMode" mat-card-avatar src="{{ avatarUrl }}" />
      <h3>
        <mat-icon mat-card-avatar [hidden]="!newMode || avatarUrl">person</mat-icon> Your Profile
      </h3>
    </mat-card-header>
    <mat-horizontal-stepper [linear]="true" #stepper>
      <mat-step [stepControl]="basicInfoGroup">
        <form [formGroup]="basicInfoGroup">
          <ng-template matStepLabel>Basic Info</ng-template>
          <mat-form-field class="field-full-width">
            <input matInput placeholder="First Name" formControlName="fname" />
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <input matInput placeholder="Last Name" formControlName="lname" />
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field floatLabel="always" class="mat-form-field--no-underline">
            <mat-radio-group name="genderControl" formControlName="gender" [(ngModel)]="genderSelected">
              <mat-radio-button value="M" [checked]="gender === 'M'">Male&nbsp;&nbsp;</mat-radio-button>
              <mat-radio-button value="F" [checked]="gender === 'F'">Female</mat-radio-button>
              <input matInput placeholder="Input" style="display: none" />
            </mat-radio-group>
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <input matInput placeholder="Email" formControlName="email" />
            <mat-error>{{ getErrorMessage() }}</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <input matInput [matDatepicker]="picker" formControlName="birthyear" [min]="minDate" [max]="maxDate" placeholder="When were you born?" />
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker startView="multi-year" [startAt]="yearStart" #picker (yearSelected)="birthYearSelected($event, picker)"></mat-datepicker>
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <input type="text" matInput placeholder="Which country are you from?" formControlName="origin" [matAutocomplete]="auto" />
            <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn">
              <mat-option *ngFor="let option of filteredCountriesOrigin | async" [value]="option">
                {{ option.name }}
              </mat-option>
            </mat-autocomplete>
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <input type="text" matInput placeholder="Where do you live?" formControlName="location" [matAutocomplete]="auto2" />
            <mat-autocomplete #auto2="matAutocomplete" [displayWith]="displayFn">
              <mat-option (onSelectionChange)="setLocation(option)" *ngFor="let option of filteredCountriesLocation | async" [value]="option">
                {{ option.name }}
              </mat-option>
            </mat-autocomplete>
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <input matInput type="text" placeholder="Postcode" formControlName="postcode" />
            <mat-error>Required</mat-error>
          </mat-form-field>
          <div [hidden]="!basicInfoGroup.get('postcode').value">
            <app-map [postcode]="basicInfoGroup.get('postcode').value" [countryCode]="basicInfoGroup.get('location').value" (latLng)="setLatLng($event)"></app-map>
          </div>
          <button style="float:right;" mat-button matStepperNext>
            Next
          </button>
        </form>
      </mat-step>
      <mat-step [stepControl]="detailGroup">
        <form [formGroup]="detailGroup">
          <ng-template matStepLabel>About You</ng-template>
          <label *ngIf="detailGroup.get('musictype').value.length > 0">What are your favourite music genres?</label>
          <mat-form-field class="field-full-width">
              <input matInput style="display: none" />
              <kendo-multiselect
              #musicGenreList
              formControlName="musictype"
              [data]="data"
              [filterable]="true"
              [textField]="'name'"
              [valueField]="'_id'"
              placeholder="What are your favourite music genres?"
              [allowCustom]="true"
              [valueNormalizer]="valueNormalizer" 
          >
          </kendo-multiselect>
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <mat-select placeholder="What's your involvement in the scene?" formControlName="membertype">
              <mat-option value="raver">I'm a Raver</mat-option>
              <mat-option value="dj">I'm a DJ</mat-option>
              <mat-option value="musician">I'm a Musician</mat-option>
              <mat-option value="decorator">I'm a Decor Artist</mat-option>
              <mat-option value="promoter">I'm a Performer</mat-option>
              <mat-option value="promoter">I'm an Event Promoter</mat-option>
            </mat-select>
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <input matInput [matDatepicker]="picker2" formControlName="startyear" [min]="minDate" [max]="maxDate" placeholder="When did you start partying?" />
            <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
            <mat-datepicker startView="multi-year" [startAt]="yearStart" #picker2 (yearSelected)="partyStartYearSelected($event, picker2)"></mat-datepicker>
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <mat-select placeholder="How often do you attend parties?" formControlName="partyfrequency">
              <mat-option value="one">Every week</mat-option>
              <mat-option value="two">Twice a month</mat-option>
              <mat-option value="three">Once a month</mat-option>
              <mat-option value="four">Regularly</mat-option>
              <mat-option value="five">Occassionally</mat-option>
              <mat-option value="six">Rarely</mat-option>
              <mat-option value="seven">Never</mat-option>
            </mat-select>
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <input matInput placeholder="What are your favourite parties?" formControlName="favouriteparty" />
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <mat-select placeholder="How often do you attend festivals?" formControlName="festivalfrequency">
              <mat-option value="1">Once a year</mat-option>
              <mat-option value="2">Several times a year</mat-option>
              <mat-option value="3">Frequently</mat-option>
              <mat-option value="4">Never</mat-option>
            </mat-select>
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <input matInput placeholder="What are your favourite festivals?" formControlName="favouritefestival" />
            <mat-error>Required</mat-error>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <textarea class="reasonField" matInput placeholder="Tell us something about yourself" formControlName="bio"></textarea>
          </mat-form-field>
          <button style="float:right;" mat-button matStepperNext>Next</button>
          <button style="float:right;" mat-button matStepperPrevious>Back</button>
        </form>
      </mat-step>
      <mat-step [stepControl]="opinionGroup">
        <form [formGroup]="opinionGroup">
          <ng-template matStepLabel>Your opinions</ng-template>
          <mat-form-field class="field-full-width">
            <mat-select placeholder="What is Psytrance to you?" formControlName="psystatus">
              <mat-option value="lifestyle">Is My lifestyle</mat-option>
              <mat-option value="religion">Is My Religion</mat-option>
              <mat-option value="music">Is Just Music</mat-option>
              <mat-option value="passion">Is My Passion</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field class="field-full-width">
            <textarea class="reasonField" matInput placeholder="Please describe why you feel this way" formControlName="reason"></textarea>
          </mat-form-field>
          <div>
            <button mat-button matStepperPrevious>Back</button>
            <button type="submit" mat-raised-button color="primary" (click)="registerMember()" [disabled]="
                (basicInfoGroup.pristine && opinionGroup.pristine && detailGroup.pristine) ||
                (basicInfoGroup.invalid || opinionGroup.invalid || detailGroup.invalid)
              ">
              Update
            </button>
          </div>
        </form>
      </mat-step>
    </mat-horizontal-stepper>
  </mat-card>
</div>